<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title data-i18n="appTitle">Chore Stars Child</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link rel="icon" href="/favicon.ico" />
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="manifest" href="/manifest.json" />
  <meta name="theme-color" content="#2563eb" />
  <link rel="stylesheet" href="/style.css">
</head>

<body class="bg-blue-50 min-h-screen flex flex-col font-sans">

<!-- 1) Pantalla inicial: Padre registra/inicia y Niño se une -->
<div
  id="initial-screen"
  class="fixed inset-0 bg-white z-50 flex flex-col items-center justify-center p-4"
  style="display: block"
>
  <!-- Idioma -->
  <div class="mb-6 text-center">
    <span class="mr-2" data-i18n="languageLabel">Idioma:</span>
    <div id="welcome-lang-buttons" class="inline-flex border rounded overflow-hidden">
      <button data-value="es" class="px-4 py-2 text-sm font-medium">Español</button>
      <button data-value="en" class="px-4 py-2 text-sm font-medium">English</button>
    </div>
  </div>

  <!-- Auth padre -->
  <section id="auth-section" class="mb-6 w-full max-w-md">
    <h2 class="text-center text-xl font-bold mb-4" data-i18n="authTitle">👫 Padres – Registro / Login</h2>
    <div id="auth-error" class="text-red-600 mb-2"></div>
    <input
      id="auth-email"
      type="email"
      placeholder="Email"
      data-i18n-placeholder="authEmailPlaceholder"
      class="w-full p-2 mb-2 border rounded"
    />
    <input
      id="auth-pass"
      type="password"
      placeholder="Contraseña"
      data-i18n-placeholder="authPassPlaceholder"
      class="w-full p-2 mb-4 border rounded"
    />
    <button
      id="btn-signup"
      data-i18n="signupBtn"
      class="w-full bg-blue-600 text-white p-2 rounded mb-2"
    >
      Registrarse
    </button>
    <button
      id="btn-login"
      data-i18n="loginBtn"
      class="w-full bg-green-600 text-white p-2 rounded"
    >
      Iniciar sesión
    </button>
  </section>

<!-- Join hijo -->
<section id="child-join-section" class="w-full max-w-md">
  <h2 class="text-center text-xl font-bold mb-4" data-i18n="joinTitle">👦👧 Unirse a la familia</h2>
  <div id="join-error" class="text-red-600 mb-2"></div>

  <input
    id="join-family-code"
    type="text"
    placeholder="Código familiar"
    data-i18n-placeholder="joinCodePlaceholder"
    class="w-full p-2 mb-2 border rounded"
  />

  <input
    id="join-child-name"
    type="text"
    placeholder="Nombre del niño"
    data-i18n-placeholder="joinNamePlaceholder"
    class="w-full p-2 mb-2 border rounded"
  />

  <input
    id="join-child-age"
    type="number"
    min="1"
    placeholder="Edad"
    data-i18n-placeholder="joinAgePlaceholder"
    class="w-full p-2 mb-4 border rounded"
  />

  <button
    id="btn-join-family"
    data-i18n="joinBtn"
    class="w-full bg-purple-600 text-white p-2 rounded"
  >
    Unirse
</button>
</section>
</div>



<!-- 2) Pantalla de invitación (solo padres sin hijos) -->
<div
  id="invite-screen"
  class="fixed inset-0 bg-white z-50 flex flex-col items-center justify-center p-4"
  style="display:none"
>
  <h2 class="text-xl font-bold mb-4" data-i18n="inviteTitle">
    Agrega a tus hijos
  </h2>
  <p class="mb-2" data-i18n="shareCodeLabel">
    Comparte este código familiar:
  </p>
  <pre id="invite-code-display" class="text-lg font-mono mb-4"></pre>

  <button
    id="btn-copy-code"
    class="w-full bg-indigo-600 text-white p-2 rounded mb-2"
    data-i18n="copyCodeBtn"
  >
    Copiar código
  </button>

  <button
    id="btn-share-link"
    class="w-full bg-indigo-600 text-white p-2 rounded mb-2"
    data-i18n="shareLinkBtn"
  >
    Compartir enlace
  </button>
</div>


<!-- 3) Pantalla de bienvenida (solo padres con hijos) -->
<div
  id="welcome-screen"
  class="fixed inset-0 bg-white z-50 flex flex-col items-center justify-center p-4"
  style="display:none"
>
  <img
    id="welcome-logo"
    src="assets/logo.png"
    alt="Chore Stars Logo"
    class="h-12 w-auto mb-4"
  />

  <h1 class="text-center text-3xl font-extrabold mb-2" data-i18n="welcomeTitle">
    Bienvenido a Chore Stars Child
  </h1>

  <!-- Muestro también el familyCode -->
  <p class="mb-4">
    <span data-i18n="yourCodeLabel">Tu código:</span>
    <strong id="family-code-display" class="font-mono"></strong>
  </p>

  <!-- Lista en tiempo real de niños -->
  <h2 class="text-lg font-semibold mb-2" data-i18n="registeredChildrenTitle">
    Niños registrados
  </h2>
  <ul
    id="children-list"
    class="w-full max-w-md mb-6 list-disc list-inside text-gray-700"
  >
    <!-- Se rellena dinámicamente -->
  </ul>

  <!-- Rol (no suele cambiarse aquí) -->
  <div class="mb-6 text-center">
    <span class="mr-2" data-i18n="roleLabel">Rol:</span>
    <div id="welcome-role-buttons" class="inline-flex border rounded overflow-hidden">
      <button data-value="parent" class="px-4 py-2 text-sm font-medium" data-i18n="roleParent">Padre</button>
      <button data-value="child" class="px-4 py-2 text-sm font-medium" data-i18n="roleChild">Niño</button>
    </div>
  </div>

  <button id="welcome-start" class="btn btn-primary px-6 py-2" data-i18n="startBtn">
    Comenzar
  </button>
</div>

<!-- 4) Contenedor principal de la app -->
<div id="app-root" style="display:none">
  <!-- ... aquí va el resto de tu app ... -->
</div>


  <!-- Header -->
  <header class="app-header">
    <div class="header-info flex items-center">
      <img
        id="app-logo"
        src="assets/logo.png"
        alt="Chore Stars Child Logo"
        class="h-12 w-auto mr-3"
      />
      <div>
        <h1 class="text-2xl font-extrabold" data-i18n="appTitle">Chore Stars Child</h1>
        <label class="text-sm opacity-80">
          <span data-i18n="panelSubtitle">
            Panel de tareas, deberes y recompensas para
          </span>
          <span id="child-name-label" class="font-extrabold"></span>
        </label>
      </div>
    </div>
    <div class="header-stats text-sm">
      <p>⭐ <span data-i18n="earnedLabel">Ganadas</span>: <span id="points-earned">0</span></p>
      <p>⭐❌ <span data-i18n="lostLabel">Perdidas</span>: <span id="points-lost">0</span></p>
      <p>⭐🎁 <span data-i18n="redeemedLabel">Canjeadas</span>: <span id="points-redeemed">0</span></p>
      <p class="total">⭐ <span data-i18n="totalLabel">Totales</span>: <span id="points-total">0</span></p>
    </div>
  </header>

  <!-- Tabs -->
  <nav class="app-nav">
    <button class="tab-btn tab-active" data-tab="tasks" data-i18n="tabTasks">Tareas</button>
    <button class="tab-btn"        data-tab="rewards" data-i18n="tabRewards">Recompensas</button>
    <button class="tab-btn"        data-tab="settings" data-i18n="tabSettings">Configuración</button>
  </nav>

  <!-- Main content -->
  <main class="flex-1 overflow-auto">

    <!-- Tasks tab -->
    <section id="tasks" class="tab-content visible space-y-6">
      <div id="today-header" class="text-sm text-gray-600 mb-2 text-center">
        <span data-i18n="todayLabel">Hoy es:</span>
        <span id="today-date"></span>
      </div>

      <section class="tasks-section text-center">
        <label class="tasks-title" data-i18n="assignedTasks">📝 Tareas asignadas</label>
        <div id="tasks-list" class="tasks-grid"></div>
      </section>

      <section class="tasks-section flex justify-center items-center text-center w-full">
        <div
          id="task-suggestions"
          class="mt-4 w-full max-w-lg mx-auto"
        ></div>
      </section>


      <div class="bg-gray-200 rounded-full h-4 w-full">
        <div id="progress-bar"
             class="bg-starGreen h-4 rounded-full transition-all duration-300"
             style="width: 0%;"></div>
      </div>

      <div class="bg-yellow-100 p-4 rounded-xl shadow-md text-center">
        <label for="cutoff-time"
       class="text-lg font-semibold text-yellow-800"
       data-i18n="dailyCutoffLabel">
         
        </label>
       <p id="cutoff-display" class="text-sm text-yellow-700">
       <span data-i18n="cutoffIntro">Completa antes de</span>
       <span id="cutoff-time-display"></span>
      </p>
     </div>

      <div class="bg-green-100 p-4 rounded-xl shadow-md text-center">
        <label class="text-lg font-semibold text-green-800" data-i18n="currentWeekLabel">
           Semana en curso
        </label>
        <p class="text-sm text-green-700">
          <span data-i18n="fromLabel">Desde:</span>
          <span id="week-start"></span>
          &nbsp;<span data-i18n="toLabel">Hasta:</span>
          <span id="week-end"></span>
        </p>
      </div>

      <div class="bg-purple-100 p-4 rounded-xl shadow-md text-center">
        <label class="text-lg font-semibold text-purple-800" data-i18n="weeklyHistoryLabel">
           Historial de semanas anteriores
        </label>
        <div id="weekly-history-list" class="space-y-2 text-sm text-purple-700">
          <p id="no-history" data-i18n="noHistory">No hay semanas cerradas aún.</p>
        </div>
      </div>

      <div class="bg-white p-4 rounded-xl shadow-md text-center">
        <label class="text-lg font-bold text-starPurple" data-i18n="badgesLabel">
          🏅 Insignias desbloqueadas esta semana
        </label>
        <div id="badge-list" class="flex gap-4 mt-2 text-2xl"></div>
      </div>
    </section>

    <!-- Rewards tab -->
    <section id="rewards" class="tab-content hidden space-y-4">
      <div id="rewards-list" class="space-y-2"></div>
      <div id="redeemed-cards" class="mt-4"></div>
    </section>

    <!-- Settings tab -->
    <section id="settings" class="tab-content hidden space-y-8 text-center">

      <p class="font-semibold text-lg mt-4" data-i18n="parentsIntro">
        Espacio para uso exclusivo de los padres
      </p>

<!-- Child management -->
<div class="settings-section">
  <label
    class="font-semibold text-lg block mb-2"
    data-i18n="childManagementLabel"
  >
    Gestión de niños
  </label>

  <p class="mb-4">
    <span data-i18n="yourCodeLabel">Código familiar:</span>
    <strong id="settings-family-code" class="font-mono"></strong>
  </p>

  <h2 class="text-lg font-semibold mb-2" data-i18n="registeredChildrenTitle">
    Niños registrados
  </h2>

  <ul
    id="settings-children-list"
    class="w-full max-w-md list-disc list-inside text-gray-700 space-y-2"
  >
    <!-- Se rellena dinámicamente -->
  </ul>
</div>


      <!-- Daily cutoff -->
      <div class="settings-section">
        <label for="cutoff-time"
               class="font-semibold text-lg block mb-2"
               data-i18n="cutoffTimeLabel">
           Hora límite diaria para completar las tareas
        </label>
        <div class="flex gap-2 items-center">
          <input id="cutoff-time"
                 type="time"
                 class="input flex-1" />
          <button id="save-cutoff"
                  class="btn btn-primary"
                  data-i18n="saveCutoffBtn">
            Guardar hora
          </button>
        </div>
      </div>

      <!-- PIN -->
      <div class="settings-section">
        <label for="pin-input"
               class="font-semibold text-lg block mb-2"
               data-i18n="pinLabel">
           PIN de acceso al panel de configuración
        </label>
        <div class="flex gap-2 items-center">
          <input id="pin-input"
                 type="password"
                 class="input flex-1"
                 placeholder=""
                 data-i18n-placeholder="pinPlaceholder" />
          <button id="save-pin"
                  class="btn btn-primary"
                  data-i18n="savePinBtn">
            Guardar PIN
          </button>
          <p id="pin-status"
             class="text-sm text-green-600 hidden ml-2"
             data-i18n="pinSavedMsg">
            PIN guardado correctamente.
          </p>
        </div>
      </div>

<!-- Task management -->
<div class="settings-section">
  <label 
    for="new-task-name"
    class="font-semibold text-lg block mb-2"
    data-i18n="taskManagementLabel"
  >
     Gestión de tareas
  </label>

  <div class="flex flex-wrap gap-2 items-center">
    <!-- Nombre: ocupa el espacio restante, pero nunca menos de 150px -->
    <input
      id="new-task-name"
      type="text"
      class="input flex-grow min-w-[150px] px-3 py-2"
      placeholder=""
      data-i18n-placeholder="taskNamePlaceholder"
    />

    <!-- Puntos: fijo y estrecho -->
    <input
      id="new-task-points"
      type="number"
      class="input w-20 px-3 py-2"
      placeholder=""
      data-i18n-placeholder="taskPointsPlaceholder"
    />

    <!-- Frecuencia: ancho medio consistente -->
    <select
      id="new-task-frequency"
      class="input w-32 px-3 py-2"
      aria-label="Frequency selector"
    >
      <option value="daily"   data-i18n="frequencyDaily"></option>
      <option value="weekly"  data-i18n="frequencyWeekly"></option>
    </select>

    <!-- Botón: tamaño automático, sin crecer -->
    <button
      id="add-task"
      class="btn btn-success flex-shrink-0 px-4 py-2"
      data-i18n="addTaskBtn"
    ></button>
  </div>

  <div id="tasks-manage" class="cards-grid mt-4"></div>
</div>


<!-- Reward management -->
<div class="settings-section">
  <label
    for="new-reward-name"
    class="font-semibold text-lg block mb-2"
    data-i18n="rewardManagementLabel"
  >
    Gestión de recompensas
  </label>
  <div class="flex gap-2 items-center">
    <input
      id="new-reward-name"
      type="text"
      class="input flex-1"
      placeholder=""
      data-i18n-placeholder="rewardNamePlaceholder"
    />
    <input
      id="new-reward-cost"
      type="number"
      class="input w-24"
      placeholder=""
      data-i18n-placeholder="rewardCostPlaceholder"
    />
    <input
      id="new-reward-stock"
      type="number"
      class="input w-24"
      placeholder=""
      data-i18n-placeholder="rewardStockPlaceholder"
    />
    <button
      id="add-reward"
      class="btn btn-warning flex-shrink-0 px-4 py-2"
      data-i18n="addRewardBtn"
    >
      Añadir recompensa
    </button>
  </div>
  <div id="rewards-manage" class="cards-grid mt-4"></div>
</div>


      <!-- Close week -->
      <div class="settings-section">
        <label class="font-semibold text-lg block mb-2" data-i18n="closeWeekLabel">
           Cerrar semana y guardar historial
        </label>
        <div class="flex justify-start gap-2">
          <button id="reset-week"
                  class="btn btn-primary"
                  data-i18n="closeWeekBtn">
            Cerrar semana
          </button>
        </div>
        <div id="weekly-summary-box" class="mt-4 text-sm text-left space-y-2"></div>
      </div>

      <!-- Closed weeks history -->
      <div class="settings-section">
        <label class="font-bold text-lg block mb-2" data-i18n="closedWeeksLabel">
           Historial de semanas cerradas
        </label>
        <div id="closed-weeks-history"></div>
      </div>

      <!-- Install updates -->
      <div class="settings-section">
        <label for="install-updates"
               class="font-semibold text-lg block mb-2"
               data-i18n="installUpdatesLabel">
          Recarga la versión más reciente de la app
        </label>
        <div class="flex justify-start gap-2">
          <button id="install-updates"
                  class="btn btn-success"
                  data-i18n="installUpdatesBtn">
            Instalar actualizaciones
          </button>
        </div>
      </div>

      <!-- Reset app -->
      <div class="settings-section">
        <label class="font-semibold text-lg block mb-2" data-i18n="resetAppLabel">
           Reiniciar la app al estado inicial
        </label>
        <div class="flex justify-start gap-2">
          <button id="reset-app"
                  class="btn btn-danger"
                  data-i18n="resetAppBtn">
            Reiniciar aplicación
          </button>
        </div>
      </div>
    </section>

  </main>

<!-- Modal resumen semanal funcional -->
<div id="weekly-summary-overlay" style="
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.5);
  z-index: 9999;
  justify-content: center;
  align-items: center;
  flex-direction: column;
  font-family: sans-serif;
" class="flex">
  <div id="weekly-summary-modal" style="
    background: white;
    padding: 2rem;
    border-radius: 8px;
    max-width: 400px;
    width: 100%;
    text-align: center;
    box-shadow: 0 10px 25px rgba(0,0,0,0.2);
  ">
    <h2 style="font-size: 1.25rem; font-weight: bold; margin-bottom: 1rem;">📅 Resumen de la semana</h2>
    <div id="weekly-summary-content" style="font-size: 0.9rem; text-align: left; margin-bottom: 1rem;"></div>
    <button id="close-weekly-summary" style="
      background-color: #3b82f6;
      color: white;
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    ">Cerrar</button>
  </div>
</div>


  <!-- Modal para PIN -->
  <div id="modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="slide-up bg-white p-6 rounded shadow text-center max-w-md w-full">
      <p id="modal-message" class="mb-4 text-lg font-semibold">Introduce el PIN para acceder a Configuración:</p>
      <input id="modal-pin" type="password" class="input mb-4" placeholder="PIN">
      <div class="space-x-2">
        <button id="modal-confirm" class="btn-primary">Acceder</button>
        <button id="modal-cancel" class="btn-secondary">Cancelar</button>
      </div>
    </div>
  </div>

   <div id="toast"
       class="fixed bottom-4 right-4 bg-white text-gray-800 shadow-lg rounded px-4 py-3 hidden z-50">
  </div>

<!-- Change rol -->
<div class="settings-section mt-8">
  <div class="flex justify-center">
    <button
      id="toggle-role-btn"
      class="btn btn-primary"
      data-i18n="toggleRoleBtn"
    >
      Cambiar rol
    </button>
  </div>
</div>

<!-- Footer -->
<footer id="app-footer" class="text-center py-4 bg-gray-100">
  <span data-i18n="footerText"></span>
</footer>


<script type="module" src="/src/main.js"></script>
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/service-worker.js');
    }
  </script>
</body>
</html>
